<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Ktor SDUI 스크린</title>
</head>
<body>
<h1>실시간 스크린</h1>
<div id="screen" style="border: 2px solid black; padding: 10px; min-height: 500px; position: relative;">
</div>

<script>
    const ws = new WebSocket("ws://localhost:8080/ws");
    const screenDiv = document.getElementById("screen");

    ws.onopen = () => {
        console.log("서버와 WebSocket 연결됨.");
    };
    ws.onmessage = (event) => {
        console.log("서버 메시지 수신:", event.data);

        let commands = JSON.parse(event.data);
        if (!Array.isArray(commands)) {
            commands = [commands];
        }

        commands.forEach(command => {

            if (command.action === "Create") {
                let el;
                if (command.type === "Text") {
                    el = document.createElement("p");
                } else if (command.type === "Button") {
                    el = document.createElement("button");
                } else {
                    el = document.createElement("div");
                }

                el.id = command.id;
                el.innerText = command.text || command.type;

                // 간단하게 스타일을 적용하는 부분
                el.style.position = 'absolute'; // 위치 기반으로 변경
                el.style.top = (command.offsetY || 10) + 'px'; // 'px' 단위 추가
                el.style.left = (command.offsetX || 10) + 'px'; // 'px' 단위 추가
                el.style.width = (command.width || 200) + 'px'; // 'px' 단위 추가
                el.style.height = (command.height || 150) + 'px'; // 'px' 단위 추가
                el.style.border = '1px solid gray'; // 구분을 위한 테두리

                screenDiv.appendChild(el);

            } else if (command.action === "Delete") {
                const elToRemove = document.getElementById(command.id);
                if (elToRemove) {
                    elToRemove.remove();
                }

            // 업데이트 커맨드를 수행하는 부분
            } else if (command.action === "Update") {
                const elToUpdate = document.getElementById(command.id);

                if (elToUpdate) {
                    // 텍스트 업데이트 (기존 로직)
                    if (command.text) {
                        elToUpdate.innerText = command.text;
                    }

                    // 위치 및 크기 업데이트
                    elToUpdate.style.position = 'absolute';
                    elToUpdate.style.top = command.offsetY + 'px';
                    elToUpdate.style.left = command.offsetX + 'px';
                    elToUpdate.style.width = command.width + 'px';
                    elToUpdate.style.height = command.height + 'px';
                }
            }
        });
    };
</script>
</body>
</html>
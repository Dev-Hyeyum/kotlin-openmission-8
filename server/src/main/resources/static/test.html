<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Ktor SDUI 스크린</title>
    <style>
        body {
            // 캔버스의 크기를 정의하는 부분
            width: 2500px;
            height: 5000px;
            margin: 0;
            padding: 0;
            position: relative;
        }
        h1 {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 1000;
        }
    </style>
</head>
<body>
<script>
    const ws = new WebSocket("ws://localhost:8080/ws");
    function applyStylesAndText(el, command) {
        // 컴포넌트의 크기를 가져옴
        const width = command.width || 200;
        const height = command.height || 150;
        // 컴포넌트의 위치 오프셋을 가져옴
        let offsetX = command.offsetX || 10;
        let offsetY = command.offsetY || 10;

        // 크기, 위치값을 적용
        el.style.position = 'absolute';
        el.style.top = offsetY + 'px';
        el.style.left = offsetX + 'px';
        el.style.width = width + 'px';
        el.style.height = height + 'px';
        el.style.border = '1px solid gray';

        // 4. 텍스트 적용
        if (command.text) {
            el.innerText = command.text;
        }
    }


    ws.onopen = () => {
        console.log("서버와 WebSocket 연결됨.");
    };

    ws.onmessage = (event) => {
        console.log("서버 메시지 수신:", event.data);

        let commands = JSON.parse(event.data);
        if (!Array.isArray(commands)) {
            commands = [commands];
        }

        commands.forEach(command => {

            if (command.action === "Create") {
                let el;
                if (command.type === "Text") {
                    el = document.createElement("p");
                } else if (command.type === "Button") {
                    el = document.createElement("button");
                } else {
                    el = document.createElement("div");
                }
                el.id = command.id;

                applyStylesAndText(el, command);

                document.body.appendChild(el);

            } else if (command.action === "Delete") {
                const elToRemove = document.getElementById(command.id);
                if (elToRemove) {
                    elToRemove.remove();
                }

            } else if (command.action === "Update") {
                const elToUpdate = document.getElementById(command.id);
                if (elToUpdate) {
                    applyStylesAndText(elToUpdate, command);
                }
            }
        });
    };
</script>
</body>
</html>